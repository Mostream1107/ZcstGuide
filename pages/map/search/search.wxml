<!--pages/map/search/search.wxml-->
<view class="root">
  <input class="input" placeholder="è¯·è¾“å…¥è¦æœç´¢çš„åœ°ç‚¹" bindinput="getContent" type="text" />
  <view class="input_search" type="primary" bindtap="goSearch">
    æœç´¢
  </view>
</view>

<!-- æ¨èåŒºåŸŸ -->
<view class="recommendations-container">
  
  <!-- åŸºäºæ—¶é—´çš„æ¨èåŒºåŸŸ -->
  <view class="recommendation-section time-based-recommendations" wx:if="{{showTimeBasedRecommendations && timeBasedRecommendations.length > 0}}">
    <view class="recommendation-header">
      <text class="recommendation-title">{{timePeriodText}}</text>
      <text class="recommendation-close" bindtap="toggleTimeBasedRecommendations">Ã—</text>
    </view>
    <scroll-view scroll-x="true" class="recommendation-scroll">
      <view class="recommendation-items">
        <view wx:for="{{timeBasedRecommendations}}" wx:key="id" class="recommendation-item time-item" bindtap="selectTimeBasedRecommendation" data-location="{{item}}">
          <view class="recommendation-category">{{item.category || 'æœªåˆ†ç±»'}}</view>
          <view class="recommendation-name">{{item.name}}</view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- ä¸ªæ€§åŒ–æ¨èåŒºåŸŸ -->
  <view class="recommendation-section personalized-recommendations" wx:if="{{showPersonalizedRecommendations && personalizedRecommendations.length > 0}}">
    <view class="recommendation-header">
      <text class="recommendation-title">çŒœä½ æƒ³å»</text>
      <view class="recommendation-actions">
        <text class="recommendation-refresh" bindtap="refreshRecommendations">ğŸ”„</text>
        <text class="recommendation-close" bindtap="togglePersonalizedRecommendations">Ã—</text>
      </view>
    </view>
    <scroll-view scroll-x="true" class="recommendation-scroll">
      <view class="recommendation-items">
        <view wx:for="{{personalizedRecommendations}}" wx:key="id" class="recommendation-item" bindtap="selectPersonalizedRecommendation" data-location="{{item}}">
          <view class="recommendation-category">{{item.category || 'æœªåˆ†ç±»'}}</view>
          <view class="recommendation-name">{{item.name}}</view>
          <view class="recommendation-score" wx:if="{{item.recommendScore}}">åŒ¹é…åº¦: {{item.recommendScore.toFixed(1)}}</view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- çƒ­é—¨åœ°ç‚¹æ¨èåŒºåŸŸ -->
  <view class="recommendation-section popular-locations" wx:if="{{showPopularLocations && popularLocations.length > 0}}">
    <view class="recommendation-header">
      <text class="recommendation-title">çƒ­é—¨åœ°ç‚¹</text>
      <text class="recommendation-close" bindtap="togglePopularLocations">Ã—</text>
    </view>
    <scroll-view scroll-x="true" class="recommendation-scroll">
      <view class="recommendation-items">
        <view wx:for="{{popularLocations}}" wx:key="id" class="recommendation-item popular-item" bindtap="selectPopularLocation" data-location="{{item}}">
          <view class="recommendation-category">{{item.category || 'æœªåˆ†ç±»'}}</view>
          <view class="recommendation-name">{{item.name}}</view>
          <view class="popular-freq">
            <text class="popular-visited">è®¿é—®{{item.frequency}}æ¬¡</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>

<view class="read-in">
  <view class="headline">
    <view class="head-headline">
      <image class="icon-right" src="{{history}}"></image>
      <view class="headline-size">æœç´¢å†å²</view>
      <image class="icon-right" src="{{delete}}" catchtap="remove"></image>
    </view>

    <view class="lately-main" wx:if="{{historyStorage.length!=0}}" hidden="{{historyStorageShow?false:true}}">
      <view class="chunk" wx:for="{{historyStorage}}" wx:key="index" bindtap='goHistorySearch' data-index='{{index}}' data-postname="{{item}}">
        <text>{{item}}</text>
      </view>
    </view>

    <view wx:else style="height: 40px;margin-top: 10px;display: flex;justify-content: center;align-items: center;color: grey;">æœç´¢å†å²ä¸ºç©º</view>
  </view>
</view>

<view class="result">
  <view>
    <view class="head-headline">
      <image class="icon-right" src="{{searchIcon}}"></image>
      <view class="headline-size">æœç´¢ç»“æœ</view>
    </view>

    <view wx:if="{{result&&result.length>0}}" class="result-list" wx:for="{{result}}" wx:key="*this" data-name="{{item.name}}" data-latitude="{{item.latitude}}" data-longitude="{{item.longitude}}" bindtap="tapback">
      <view class="item">
        <view class="item-name">
          <text>{{item.name}}</text>
          <text class="item-match-label" wx:if="{{item.matchType}}">
            {{item.matchType == 'exact' ? 'ç²¾ç¡®åŒ¹é…' : 
              item.matchType == 'alias' ? 'åˆ«ååŒ¹é…' : 
              item.matchType == 'partial' ? 'éƒ¨åˆ†åŒ¹é…' : 
              item.matchType == 'partialAlias' ? 'åˆ«ååŒ…å«' : 
              item.matchType == 'keyword' ? 'å…³é”®è¯åŒ¹é…' : ''}}
          </text>
        </view>
        <view class="item-info">
          <view class="info-group" wx:if="{{item.aliases}}">
            <text class="info-label">åˆ«å:</text>
            <text class="item-alias">{{item.aliases}}</text>
          </view>
          <view class="tag-group">
            <text class="item-category" wx:if="{{item.category}}">{{item.category}}</text>
          </view>
        </view>
      </view>
      <view class="item-arrow">></view>
    </view>
  </view>

  <view wx:if="{{result&&result.length==0}}" class="middle">
    æŠ±æ­‰ï¼Œæ²¡æœ‰æ‰¾åˆ°æ‚¨æƒ³æ‰¾çš„åœ°ç‚¹
  </view>
</view>